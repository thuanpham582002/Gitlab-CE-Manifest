# GitLab Helm Chart Configuration
# External IP: 10.254.139.26

global:
  # Use Community Edition instead of Enterprise
  edition: ce

  # Configure host settings with external IP
  hosts:
    domain: gitlab.local
    https: false  # Set to false for HTTP access
    externalIP: 10.254.139.26
    ssh: 10.254.139.26
    gitlab:
      name: gitlab

  # Override image registry for environments that can't access registry.gitlab.com
  image:
    registry: docker.io
  certificates:
    image:
      repository: docker.io/gitlab-org/build/cng/certificates
  kubectl:
    image:
      repository: docker.io/gitlab-org/build/cng/kubectl
  cfssl:
    image:
      repository: cfssl/cfssl
      tag: latest
  gitlabBase:
    image:
      repository: gitlab/gitlab-base
      tag: latest

  # Disable cert-manager since we already have it installed
  ingress:
    configureCertmanager: false
    enabled: false  # Disable Ingress since we're using external IP

# Disable cert-manager installation since it's already installed
installCertmanager: false

# GitLab CE specific configurations
gitlab:
  # Enable GitLab CE features
  webservice:
    ingress:
      enabled: false
    service:
      type: ClusterIP
      port: 9070  # Internal port for web service

  # Shell/SSH service
  gitlab-shell:
    service:
      type: ClusterIP
      port: 22  # Standard SSH port

# Disable unnecessary features for resource optimization
registry:
  enabled: false

gitlab-runner:
  enabled: false
  image:
    repository: gitlab/gitlab-runner
    tag: latest

pages:
  enabled: false

mattermost:
  enabled: false

# GitLab image configuration to override registry.gitlab.com
gitlab:
  webservice:
    image:
      repository: gitlab/gitlab-ce
      tag: latest
    workhorse:
      image:
        repository: gitlab/gitlab-workhorse-ce
        tag: latest
  sidekiq:
    image:
      repository: gitlab/gitlab-ce
      tag: latest
  gitaly:
    image:
      repository: gitlab/gitaly
      tag: latest
  gitlab-shell:
    image:
      repository: gitlab/gitlab-shell
      tag: latest
  migrations:
    image:
      repository: gitlab/gitlab-ce
      tag: latest
  gitlab-exporter:
    image:
      repository: gitlab/gitlab-exporter
      tag: latest
  kas:
    image:
      repository: gitlab/gitlab-kas
      tag: latest
  toolbox:
    image:
      repository: gitlab/gitlab-toolbox-ce
      tag: latest

# Nginx ingress configuration
nginx-ingress:
  controller:
    image:
      repository: ingressnginx/controller
      tag: v1.11.8
      chroot: false

# Database configuration (embedded PostgreSQL for simplicity)
postgresql:
  install: true
  auth:
    database: gitlabhq_production
    username: postgres
    password: gitlabpassword

# Redis configuration (embedded Redis for simplicity)
redis:
  install: true
  auth:
    enabled: true
    password: redispassword

# Resource limits (optional - adjust as needed)
# webservice:
#   resources:
#     limits:
#       memory: 4Gi
#       cpu: 2000m
#     requests:
#       memory: 2Gi
#       cpu: 1000m